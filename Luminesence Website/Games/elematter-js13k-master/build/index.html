<title>Elematter</title> <style>*,:after,:before{-moz-box-sizing:border-box;box-sizing:border-box;transition-duration:500ms;transition-property:none;-webkit-touch-callout:none;-moz-user-select:none;user-select:none}body,html{height:100%}body{background:#0c0c0c;font-family:helvetica,sans-serif;overflow:hidden}.g{box-shadow:0 0 0 20px #000,0 0 0 21px #222;left:50%;opacity:0;overflow:hidden;pointer-events:none;position:absolute;transform:translate(-50%,-50%);transition:opacity 500ms;top:50%}.g.loaded{opacity:1;pointer-events:auto}.s{bottom:0;left:0;position:absolute;right:0;top:0}.tile{background:#222;left:0;position:absolute;top:0;transition-property:background}.tile:hover{background:#666;transition-duration:0ms}.tile.path{background:#111}.tile.path:hover{cursor:not-allowed}.row{background:#000;height:40px;left:0;position:absolute;transform:translateZ(0);width:100%;z-index:200}.top-row{top:0}.bot-row{bottom:0;padding-top:1px}.game-title{background:#090909;box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.05);color:#fff;display:block;float:left;font-size:15px;font-weight:700;height:39px;line-height:37px;margin-right:1px;position:relative;text-align:center;text-shadow:0 1px 1px #000;width:360px}.game-title span{color:hsla(0,0%,100%,.3);font-size:11px;font-weight:400;margin-left:10px}.game-title:before{background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.075) 100%);content:'';height:50%;left:0;position:absolute;top:0;width:100%}.b{background:#333;box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.6);cursor:pointer;display:block;float:left;font-size:13px;height:39px;line-height:37px;margin:0 1px 0 0;position:relative;text-align:center;text-shadow:0 1px 1px #000;transition-property:background,box-shadow,color,opacity}.b:before{background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.075) 100%);content:'';height:50%;left:0;position:absolute;top:0;width:100%}.b:hover{background:#444;color:#fff;transition-duration:0ms}.s1{width:39px}.s2{width:79px}.s2:last-child{margin-right:0}.s3{width:119px}.s4{width:159px}.s4:last-child{width:160px;margin-right:0}.s5{width:199px};.s6{width:239px}.b i{display:inline-block;font-size:16px;font-style:normal;margin-right:3px}.playing .b-play{background:#222;box-shadow:inset 0 0 0 1px #333,inset 0 0 10px hsla(0,0%,0%,.75);color:#fff}.playing .b-play:hover{background:#333}.x1 .b-x1,.x1 .b-x1:hover,.x2 .b-x2,.x2 .b-x2:hover,.x3 .b-x3,.x3 .b-x3:hover{background:#222;box-shadow:inset 0 0 0 1px #333,inset 0 0 10px hsla(0,0%,0%,.75);color:#fff;cursor:default}.b-send{opacity:.25}.playing .b-send:hover{background:#444;color:#fff;cursor:pointer}.b-send:hover,.no-more-waves.playing .b-send{background:#333;color:hsla(0,0%,100%,.6);cursor:not-allowed;opacity:.25}.playing .b-send{opacity:1}.d,.l{background:#090909;box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.6);display:block;float:left;font-size:13px;height:39px;line-height:37px;margin:0 1px 0 0;position:relative;text-align:center;text-shadow:0 1px 1px #000;transition-property:background,box-shadow,color}.d:before,.l:before{background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.075) 100%);content:'';height:50%;left:0;position:absolute;top:0;width:100%}.d i,.l i{font-size:16px;font-style:normal}.l{background:#111}.w{margin:0 2px}.w-e{color:#3df43d}.w-w{color:#3db7f4}.w-a{color:#f4f43d}.w-f{color:#f43d3d}.build-menu-wrap,.tower-menu-wrap{background:hsla(0,0%,10%,.6);bottom:0;left:0;position:absolute;right:0;top:0;visibility:hidden;z-index:200}.build-menu-open .build-menu-wrap,.tower-menu-open .tower-menu-wrap{visibility:visible}.build-menu,.tower-menu{cursor:default;left:0;position:absolute;top:0;width:280px}.build-buttons,.tower-buttons{background:hsla(0,0%,0%,.75);height:80px;position:relative;width:100%}.build-buttons:before,.tower-buttons:before{background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.1) 100%);content:'';height:50%;left:0;pointer-events:none;position:absolute;top:0;width:100%;z-index:2}.build-button,.tower-button{background:#fff;border:2px solid transparent;box-shadow:inset 0 0 0 20px hsla(0,0%,100%,0);cursor:pointer;height:40px;position:absolute;top:20px;transition:background 150ms,border-color 150ms,opacity 150ms;width:40px}.build-button:hover,.tower-button:hover{border-color:#fff;opacity:.75}.build-d.anim{background:hsla(0,0%,100%,.15);border:2px dashed #fff;cursor:default;-webkit-animation:pulse 500ms ease-in-out infinite alternate;animation:pulse 500ms ease-in-out infinite alternate}.build-d{background:#fff}.build-e{background:#3df43d}.build-w{background:#3db7f4}.build-a{background:#f4f43d}.build-f{background:#f43d3d}.no-b-a .build-a,.no-b-a.hover-a .build-info>*,.no-b-e .build-e,.no-b-e.hover-e .build-info>*,.no-b-f .build-f,.no-b-f.hover-f .build-info>*,.no-b-w .build-w,.no-b-w.hover-w .build-info>*,.no-upgrade .tower-button.upgrade,.no-upgrade.hover-tower-upgrade .tower-info>*{cursor:not-allowed;opacity:.2}.no-upgrade.maxed-upgrade.hover-tower-upgrade .tower-info>*{opacity:1}.pos-w .build-d{left:20px}.pos-w .build-e{left:70px}.pos-w .build-w{left:120px}.pos-w .build-a{left:170px}.pos-e .build-d,.pos-w .build-f{left:220px}.pos-e .build-e{left:20px}.pos-e .build-w{left:70px}.pos-e .build-a{left:120px}.pos-e .build-f{left:170px}.build-info,.tower-info{background:hsla(0,0%,0%,.75);font-size:13px;height:140px;left:0;line-height:1.7;opacity:0;padding:15px 20px;pointer-events:none;position:absolute;transform:scale(0.75);transition:opacity 150ms 150ms,transform 150ms 150ms;width:100%}.hover-build-button .build-info,.hover-tower-button .tower-info{opacity:1;transform:scale(1);transition-delay:0ms}.pos-n .build-info,.pos-n .tower-info{top:81px}.pos-s .build-info,.pos-s .tower-info{bottom:81px}.build-title,.tower-title{border-bottom:1px solid #333;font-size:16px;font-weight:700;margin-bottom:7px;padding-bottom:7px}.build-title i,.tower-title i{color:#fff;font-style:normal;margin-right:14px}.hover-e .build-type{color:#3df43d}.hover-w .build-type{color:#3db7f4}.hover-a .build-type{color:#f4f43d}.hover-f .build-type{color:#f43d3d}.build-cost,.tower-cost{color:#fff}.build-stat,.tower-stat{color:#aaa}.build-stat strong,.tower-stat strong{display:inline-block;margin-right:3px;text-align:right;width:58px}.build-mtr{display:inline-block;margin-right:3px;vertical-align:top}.build-mtr span{background:#444;display:inline-block;height:12px;margin-right:1px;position:relative;top:6px;vertical-align:top;width:8px}.hover-e .build-mtr span{background:#3df43d}.hover-w .build-mtr span{background:#3db7f4}.hover-a .build-mtr span{background:#f4f43d}.hover-f .build-mtr span{background:#f43d3d}.dmg1 .build-dmg-wrap .build-mtr span:nth-child(2),.dmg1 .build-dmg-wrap .build-mtr span:nth-child(3),.dmg2 .build-dmg-wrap .build-mtr span:nth-child(3),.rng1 .build-rng-wrap .build-mtr span:nth-child(2),.rng1 .build-rng-wrap .build-mtr span:nth-child(3),.rng2 .build-rng-wrap .build-mtr span:nth-child(3),.rte1 .build-rte-wrap .build-mtr span:nth-child(2),.rte1 .build-rte-wrap .build-mtr span:nth-child(3),.rte2 .build-rte-wrap .build-mtr span:nth-child(3){background:#444}.tower-button.highlight.anim{background:hsla(0,0%,100%,.15);border:2px solid #fff;cursor:default;-webkit-animation:pulse 500ms ease-in-out infinite alternate;animation:pulse 500ms ease-in-out infinite alternate}.t-menu-e .tower-button.highlight{border-color:#3df43d}.t-menu-w .tower-button.highlight{border-color:#3db7f4}.t-menu-a .tower-button.highlight{border-color:#f4f43d}.t-menu-f .tower-button.highlight{border-color:#f43d3d}.t-menu-e .tower-button.upgrade{background:#3df43d}.t-menu-w .tower-button.upgrade{background:#3db7f4}.t-menu-a .tower-button.upgrade{background:#f4f43d}.t-menu-f .tower-button.upgrade{background:#f43d3d}.tower-button.reclaim{background:#444}.tower-button .icon{bottom:0;height:22px;left:0;margin:auto;pointer-events:none;position:absolute;right:0;top:0;width:20px}.tower-button.reclaim .icon{transform:rotate(180deg)}.tower-button .icon div{border-color:transparent;border-style:solid;left:50%;position:absolute}.tower-button .icon div:nth-child(1),.tower-button .icon div:nth-child(3),.tower-button .icon div:nth-child(5){border-width:10px;margin-left:-10px}.tower-button .icon div:nth-child(2),.tower-button .icon div:nth-child(4),.tower-button .icon div:nth-child(6){border-bottom-color:#444;border-width:5px;margin-left:-5px}.tower-button .icon div:nth-child(1){border-bottom-color:hsla(0,0%,0%,.8);top:-10px}.tower-button .icon div:nth-child(2){top:0}.tower-button .icon div:nth-child(3){border-bottom-color:hsla(0,0%,0%,.55);top:-4px}.tower-button .icon div:nth-child(4){top:6px}.tower-button .icon div:nth-child(5){border-bottom-color:hsla(0,0%,0%,.3);top:2px}.tower-button .icon div:nth-child(6){top:12px}.t-menu-e .tower-button.upgrade .icon div:nth-child(2),.t-menu-e .tower-button.upgrade .icon div:nth-child(4),.t-menu-e .tower-button.upgrade .icon div:nth-child(6){border-bottom-color:#3df43d}.t-menu-w .tower-button.upgrade .icon div:nth-child(2),.t-menu-w .tower-button.upgrade .icon div:nth-child(4),.t-menu-w .tower-button.upgrade .icon div:nth-child(6){border-bottom-color:#3db7f4}.t-menu-a .tower-button.upgrade .icon div:nth-child(2),.t-menu-a .tower-button.upgrade .icon div:nth-child(4),.t-menu-a .tower-button.upgrade .icon div:nth-child(6){border-bottom-color:#f4f43d}.t-menu-f .tower-button.upgrade .icon div:nth-child(2),.t-menu-f .tower-button.upgrade .icon div:nth-child(4),.t-menu-f .tower-button.upgrade .icon div:nth-child(6){border-bottom-color:#f43d3d}.pos-w .tower-button.highlight{left:20px}.pos-w .tower-button.upgrade{left:70px}.pos-w .tower-button.reclaim{left:120px}.pos-e .tower-button.highlight{left:220px}.pos-e .tower-button.upgrade{left:120px}.pos-e .tower-button.reclaim{left:170px}.t-menu-e .tower-label{color:#3df43d}.t-menu-w .tower-label{color:#3db7f4}.t-menu-a .tower-label{color:#f4f43d}.t-menu-f .tower-label{color:#f43d3d}.tower-stat i{color:#fff;font-style:normal}.hover-tower-reclaim .tower-stat i,.hover-tower-reclaim .tower-stat span:last-child{display:none}.t-menu-e .tower-stat span:last-child{color:#3df43d}.t-menu-w .tower-stat span:last-child{color:#3db7f4}.t-menu-a .tower-stat span:last-child{color:#f4f43d}.t-menu-f .tower-stat span:last-child{color:#f43d3d}.t-wrap,.t-wrap div{position:absolute}.t-base,.t-core,.t-slab,.t-tower{bottom:0;left:0;right:0;top:0}.t-wrap{height:40px;transition:background 300ms;width:40px;z-index:100}.t-wrap:after,.t-wrap:before{content:'';opacity:0;right:0;position:absolute;top:0;transition:opacity 400ms}.t-wrap.upgradable:after,.t-wrap.upgradable:before{background:#fff;opacity:1}.t-wrap:before{height:2px;top:3px;width:8px}.t-wrap:after{height:8px;right:3px;width:2px}.t-wrap.targeting{background:hsla(0,0%,100%,.2)}.t-wrap:hover{transition-duration:0ms;z-index:101}.t-wrap.t-type-e:hover{background:hsla(120,50%,50%,.2)}.t-wrap.t-type-w:hover{background:hsla(200,50%,50%,.2)}.t-wrap.t-type-a:hover{background:hsla(60,50%,50%,.2)}.t-wrap.t-type-f:hover{background:hsla(0,50%,50%,.2)}.t-tower{cursor:pointer;height:28px;margin:auto;width:28px}.t-range{border:2px solid transparent;border-radius:100%;left:50%;opacity:0;pointer-events:none;top:50%;transform:translate(-50%,-50%) scale(0.5);transition:all 150ms ease-in-out;z-index:1}.t-type-e .t-range{background:hsla(120,100%,90%,.1);border-color:hsla(120,100%,70%,.3)}.t-type-w .t-range{background:hsla(200,100%,90%,.1);border-color:hsla(200,100%,70%,.3)}.t-type-a .t-range{background:hsla(60,100%,90%,.1);border-color:hsla(60,100%,70%,.3)}.t-type-f .t-range{background:hsla(0,100%,90%,.1);border-color:hsla(0,100%,70%,.3)}.t-wrap.selected .t-range,.t-wrap:hover .t-range{opacity:1;transform:translate(-50%,-50%) scale(1)}.t-slab{background:#121;border:1px solid transparent}.t-type-e .t-slab{background:#0c260c;border-color:#1e7a1e}.t-type-w .t-slab{background:#0c1d26;border-color:#1e5b7a}.t-type-a .t-slab{background:#26260c;border-color:#7a7a1e}.t-type-f .t-slab{background:#260c0c;border-color:#7a1e1e}.t-base{border:4px solid #111;border-radius:50%}.t-type-e .t-base{background:#2d6b2d;box-shadow:0 0 0 1px #2d6b2d}.t-type-w .t-base{background:#2d566b;box-shadow:0 0 0 1px #2d566b}.t-type-a .t-base{background:#6b6b2d;box-shadow:0 0 0 1px #6b6b2d}.t-type-f .t-base{background:#6b2d2d;box-shadow:0 0 0 1px #6b2d2d}.t-turret{background:#6c6;height:50%;left:0;top:0;transform-origin:100% 100%;width:50%}.t-type-e .t-turret{background:#7ce87c}.t-type-w .t-turret{background:#7cc4e8}.t-type-a .t-turret{background:#e8e87c}.t-type-f .t-turret{background:#e87c7c}.t-core{border-radius:50%;margin:auto}.t-type-e .t-core{background:#65ff65}.t-type-w .t-core{background:#65cbff}.t-type-a .t-core{background:#feff65}.t-type-f .t-core{background:#ff6565}.t-lvl-bar{background:hsla(0,0%,100%,.25);bottom:0;height:2px;width:12px}.t-lvl-bar-0{left:0}.t-lvl-bar-1{left:13px;width:13px}.t-lvl-bar-2{left:27px}.t-type-e.t-lvl-0 .t-lvl-bar-0,.t-type-e.t-lvl-1 .t-lvl-bar-0,.t-type-e.t-lvl-1 .t-lvl-bar-1,.t-type-e.t-lvl-2 .t-lvl-bar-0,.t-type-e.t-lvl-2 .t-lvl-bar-1,.t-type-e.t-lvl-2 .t-lvl-bar-2{background:#47ea47}.t-type-w.t-lvl-0 .t-lvl-bar-0,.t-type-w.t-lvl-1 .t-lvl-bar-0,.t-type-w.t-lvl-1 .t-lvl-bar-1,.t-type-w.t-lvl-2 .t-lvl-bar-0,.t-type-w.t-lvl-2 .t-lvl-bar-1,.t-type-w.t-lvl-2 .t-lvl-bar-2{background:#47b4ea}.t-type-a.t-lvl-0 .t-lvl-bar-0,.t-type-a.t-lvl-1 .t-lvl-bar-0,.t-type-a.t-lvl-1 .t-lvl-bar-1,.t-type-a.t-lvl-2 .t-lvl-bar-0,.t-type-a.t-lvl-2 .t-lvl-bar-1,.t-type-a.t-lvl-2 .t-lvl-bar-2{background:#eaea47}.t-type-f.t-lvl-0 .t-lvl-bar-0,.t-type-f.t-lvl-1 .t-lvl-bar-0,.t-type-f.t-lvl-1 .t-lvl-bar-1,.t-type-f.t-lvl-2 .t-lvl-bar-0,.t-type-f.t-lvl-2 .t-lvl-bar-1,.t-type-f.t-lvl-2 .t-lvl-bar-2{background:#ea4747}.enemy{border-style:solid;border-width:4px;left:0;pointer-events:none;position:absolute;top:0;transition:box-shadow 100ms,opacity 100ms;z-index:100}.enemy.slow{box-shadow:0 0 0 8px hsla(200,100%,30%,.5);opacity:.5}.hp{border:1px solid hsla(0,0%,100%,.5);border-top:none;border-right:none;height:300%;left:-8px;position:absolute;bottom:-8px;width:300%;z-index:5}.enemy.boss .hp{left:-10px;bottom:-10px}.enemy.type-e .hp{border-color:#9f9}.enemy.type-w .hp{border-color:#99dcff}.enemy.type-a .hp{border-color:#feff99}.enemy.type-f .hp{border-color:#f99}.hl{border:1px solid #fff;border-bottom:none;border-left:none;bottom:0;left:0;right:0;position:absolute;top:0}.enemy.boss{border-width:6px}.enemy.type-e{border-color:#0b410b #0b410b #47ea47 #47ea47}.enemy.type-w{border-color:#0b2f41 #0b2f41 #47b4ea #47b4ea}.enemy.type-a{border-color:#41410b #41410b #eaea47 #eaea47}.enemy.type-f{border-color:#410b0b #410b0b #ea4747 #ea4747}.enemy.type-e .hl{border-color:#47ea47}.enemy.type-w .hl{border-color:#47b4ea}.enemy.type-a .hl{border-color:#eaea47}.enemy.type-f .hl{border-color:#ea4747}.enemy.boss:before{border:2px solid transparent;border-left:none;border-bottom:none;border-radius:100%;bottom:-18px;content:'';left:-18px;right:-18px;position:absolute;top:-18px}.enemy.type-e:before{border-color:#47ea47}.enemy.type-w:before{border-color:#47b4ea}.enemy.type-a:before{border-color:#eaea47}.enemy.type-f:before{border-color:#ea4747}.enemy:after{background:hsla(0,0%,100%,.5);bottom:-4px;content:'';left:-4px;right:-4px;opacity:0;position:absolute;top:-4px;transition:opacity 300ms ease-out}.enemy.boss:after{bottom:-6px;left:-6px;right:-6px;top:-6px}.enemy.hit:after{opacity:1;transition-duration:0ms}.enemy.type-e:after{box-shadow:0 0 0 4px #9f9}.enemy.type-w:after{box-shadow:0 0 0 4px #99dcff}.enemy.type-a:after{box-shadow:0 0 0 4px #feff99}.enemy.type-f:after{box-shadow:0 0 0 4px #f99}.bullet{border-radius:10px 10px 10px 0;left:0;position:absolute;top:0;z-index:150}.bullet.type-e{background:#9f9}.bullet.type-w{background:#99dcff}.bullet.type-a{background:#feff99}.bullet.type-f{background:#f99}@-webkit-keyframes pulse{to{opacity:0}}@keyframes pulse{to{opacity:0}}</style>  <div class="g x1">  <div class="s s-play">  <div class="row top-row"> <div class=game-title>Elematter <span>by Jack Rugile for js13kGames</span></div> <a class="b b-play s5"><i>&rtrif;</i>Play</a> <a class="b b-x1 s2">&times;1</a> <a class="b b-x2 s2">&times;2</a> <a class="b b-x3 s2">&times;3</a> </div>  <div class="row bot-row"> <div class="l s1"><i>&hearts;</i></div> <div class="d d-lives s2"> </div> <div class="l s1"><i>&there4;</i></div> <div class="d d-fragments s2"> </div> <div class="l s2">Wave</div> <div class="d d-wave s2"> </div> <div class="l s2">Next</div> <div class="d d-next s4"> &times;<span class="w w-e"> </span> &times;<span class="w w-w"> </span> &times;<span class="w w-a"> </span> &times;<span class="w w-f"> </span> </div> <a class="b b-send s4"><i>&raquo;</i>Send Next +<span class=send> </span> <i>&there4;</i></a> </div>  <div class=build-menu-wrap> <div class=build-menu> <div class=build-buttons> <a class="build-button build-d"></a> <a class="build-button build-e" data-type=e></a> <a class="build-button build-w" data-type=w></a> <a class="build-button build-a" data-type=a></a> <a class="build-button build-f" data-type=f></a> </div> <div class=build-info> <div class=build-title> <span class=build-cost> </span> <i>&there4;</i> <span class=build-type> </span> </div> <div class="build-stat build-dmg-wrap"> <strong>Damage:</strong> <span class=build-mtr><span></span><span></span><span></span></span> <span class=build-dmg> </span> </div> <div class="build-stat build-rng-wrap"> <strong>Range:</strong> <span class=build-mtr><span></span><span></span><span></span></span> <span class=build-rng> </span> </div> <div class="build-stat build-rte-wrap"> <strong>Rate:</strong> <span class=build-mtr><span></span><span></span><span></span></span> <span class=build-rte> </span> </div> </div> </div> </div>  <div class=tower-menu-wrap> <div class=tower-menu> <div class=tower-buttons> <a class="tower-button highlight anim"></a> <a class="tower-button upgrade" data-action=upgrade> <div class=icon> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> </div> </a> <a class="tower-button reclaim" data-action=reclaim> <div class=icon> <div></div> <div></div> <div></div> <div></div> <div></div> <div></div> </div> </a> </div> <div class=tower-info> <div class=tower-title> <span class=tower-cost> </span> <i>&there4;</i> <span class=tower-label> </span> </div> <div class="tower-stat tower-dmg-wrap"> <strong>Damage:</strong> <span class=tower-dmg> </span> <i>&raquo;</i> <span class=tower-dmg-next> </span> </div> <div class="tower-stat tower-rng-wrap"> <strong>Range:</strong> <span class=tower-rng> </span> <i>&raquo;</i> <span class=tower-rng-next> </span> </div> <div class="tower-stat tower-rte-wrap"> <strong>Rate:</strong> <span class=tower-rte> </span> <i>&raquo;</i> <span class=tower-rte-next> </span> </div> </div> </div> </div> </div> </div> <script>function SfxrParams(){this.setSettings=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(.18>s){var i=.18/s;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var t,e,s,i,o,a,h,n,r,d,g,l;this.reset=function(){var t=this._params;i=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(g=.5-t.n/2,l=5e-5*-t.o),n=1+t.l*t.l*(t.l>0?-.9:10),r=0,d=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return t=i.b*i.b*1e5,e=i.c*i.c*1e5,s=i.e*i.e*1e5+12,3*((t+e+s)/3|0)},this.synthWave=function(u,p){var c=this._params,m=1!=c.s||c.v,v=c.v*c.v*.1,y=1+3e-4*c.w,f=c.s*c.s*c.s*.1,w=1+1e-4*c.t,x=1!=c.s,b=c.x*c.x,C=c.g,M=c.q||c.r,S=c.r*c.r*c.r*.2,T=c.q*c.q*(c.q<0?-1020:1020),k=c.p?((1-c.p)*(1-c.p)*2e4|0)+32:0,P=c.d,B=c.j/2,q=c.k*c.k*.01,W=c.a,z=t,E=1/t,A=1/e,L=1/s,R=5/(1+c.u*c.u*20)*(.01+f);R>.8&&(R=.8),R=1-R;for(var D,G,O,F,N,I,U=!1,H=0,X=0,j=0,V=0,Y=0,_=0,J=0,K=0,Q=0,Z=0,$=new Array(1024),te=new Array(32),ee=$.length;ee--;)$[ee]=0;for(var ee=te.length;ee--;)te[ee]=2*Math.random()-1;for(var ee=0;p>ee;ee++){if(U)return ee;if(k&&++Q>=k&&(Q=0,this.reset()),d&&++r>=d&&(d=0,i*=n),a+=h,i*=a,i>o&&(i=o,C>0&&(U=!0)),G=i,B>0&&(Z+=q,G*=1+Math.sin(Z)*B),G|=0,8>G&&(G=8),W||(g+=l,0>g?g=0:g>.5&&(g=.5)),++X>z)switch(X=0,++H){case 1:z=e;break;case 2:z=s}switch(H){case 0:j=X*E;break;case 1:j=1+2*(1-X*A)*P;break;case 2:j=1-X*L;break;case 3:j=0,U=!0}M&&(T+=S,O=0|T,0>O?O=-O:O>1023&&(O=1023)),m&&y&&(v*=y,1e-5>v?v=1e-5:v>.1&&(v=.1)),I=0;for(var se=8;se--;){if(J++,J>=G&&(J%=G,3==W))for(var ie=te.length;ie--;)te[ie]=2*Math.random()-1;switch(W){case 0:N=g>J/G?.5:-.5;break;case 1:N=1-J/G*2;break;case 2:F=J/G,F=6.28318531*(F>.5?F-1:F),N=1.27323954*F+.405284735*F*F*(0>F?1:-1),N=.225*((0>N?-1:1)*N*N-N)+N;break;case 3:N=te[Math.abs(32*J/G|0)]}m&&(D=_,f*=w,0>f?f=0:f>.1&&(f=.1),x?(Y+=(N-_)*f,Y*=R):(_=N,Y=0),_+=Y,V+=_-D,V*=1-v,N=V),M&&($[K%1024]=N,N+=$[(K-O+1024)%1024],K++),I+=N}I*=.125*j*b,u[ee]=I>=1?32767:-1>=I?-32768:32767*I|0}return p}}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),s=new Uint8Array(4*((e+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(s.buffer,44),e),o=new Uint32Array(s.buffer,0,44);o[0]=1179011410,o[1]=i+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=i,i+=44;for(var a=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="data:audio/wav;base64,";i>a;a+=3){var r=s[a]<<16|s[a+1]<<8|s[a+2];n+=h[r>>18]+h[r>>12&63]+h[r>>6&63]+h[63&r]}return n},g={},g.data={},g.audio={},g.audio.sounds={},g.audio.add=function(t,e,s){g.audio.sounds[t]=[],s.forEach(function(s,i){for(g.audio.sounds[t].push({tick:0,count:e,pool:[]});e--;){var o=new Audio;o.src=jsfxr(s),g.audio.sounds[t][i].pool.push(o)}},this)},g.audio.play=function(t){var e=g.audio.sounds[t],s=e.length>1?e[Math.floor(Math.random()*e.length)]:e[0];s.pool[s.tick].play(),s.tick<s.count-1?s.tick++:s.tick=0},g.Group=function(){this.collection=[],this.length=0},g.Group.prototype.push=function(t){return this.length++,this.collection.push(t)},g.Group.prototype.pop=function(){return this.length--,this.collection.pop()},g.Group.prototype.unshift=function(t){return this.length++,this.collection.unshift(t)},g.Group.prototype.shift=function(){return this.length--,this.collection.shift()},g.Group.prototype.getAt=function(t){return this.collection[t]},g.Group.prototype.getByPropVal=function(t,e){var s=null;return this.each(function(i){return i[t]==e?(s=i,void 0):void 0},0,this),s},g.Group.prototype.removeAt=function(t){t<this.length&&(this.collection.splice(t,1),this.length--)},g.Group.prototype.remove=function(t){var e=this.collection.indexOf(t);e>-1&&(this.collection.splice(e,1),this.length--)},g.Group.prototype.empty=function(){this.collection.length=0,this.length=0},g.Group.prototype.each=function(t,e,s){var i,o=this.length,a=g.isString(t),h=s||window;if(e)for(i=0;o>i;i++)a?this.collection[i][t](i):t.bind(h,this.collection[i],i,this.collection)();else for(i=o;i--;)a?this.collection[i][t](i):t.bind(h,this.collection[i],i,this.collection)()},g.Pool=function(t,e){this.base=t,this.preallocateAmount=e||0,this.alive=[],this.dead=[],this.length=0,this.deadLength=0,this.preallocateAmount&&this.preallocate()},g.Pool.prototype.preallocate=function(){for(var t=0;t<this.preallocateAmount;t++)this.dead.push(new this.base),this.deadLength++},g.Pool.prototype.create=function(t){if(this.deadLength){var e=this.dead.pop();e.init(t),this.alive.push(e),this.deadLength--,this.length++}else{var s=new this.base;s.init(t),this.alive.push(s),this.length++}},g.Pool.prototype.release=function(t){var e=this.alive.indexOf(t);e>-1&&(this.dead.push(this.alive.splice(e,1)[0]),this.length--,this.deadLength++)},g.Pool.prototype.empty=function(){this.alive.length=0,this.dead.length=0,this.length=0,this.deadLength=0},g.Pool.prototype.each=function(t){for(var e=this.length;e--;)this.alive[e][t](e)},g.rand=function(t,e){return Math.random()*(e-t)+t},g.qS=function(t){var e=document.querySelectorAll(t);return e.length>1?e:e[0]},g.cE=function(t,e){var s=document.createElement("div");return t&&t.appendChild(s),e&&g.addClass(s,e),s},g.on=function(t,e,s,i){i=i||window,t.addEventListener(e,s.bind(i))},g.text=function(t,e){t.firstChild.nodeValue=e},g.resetAnim=function(t){g.removeClass(t,"anim"),t.offsetWidth=t.offsetWidth,g.addClass(t,"anim")},g.prefixElement=g.cE(),g.prefixMatches={},g.prefixCheck=function(t){if(g.prefixMatches[t])return[g.prefixMatches[t],!0];for(var e=["","Webkit","Moz","ms","O"],s=function(t){return t.toUpperCase()},i=0,o=e.length;o>i;i++){var a;if(a=0===i?t:e[i]+t.replace(/^\w/,s),g.isString(g.prefixElement.style[a]))return g.prefixMatches[t]=a,[a,!0]}return[t,!1]},g.css=function(t,e,s){if(g.isObject(e)){var i=e;for(e in i)i.hasOwnProperty(e)&&g.css(t,e,i[e])}else e=g.prefixCheck(e),e[1]&&(t.style[e[0]]=s)},g.hasClass=function(t,e){return e?t.classList.contains(e):void 0},g.addClass=function(t,e){e.length&&(-1!=e.indexOf(" ")?(classes=e.split(" "),classes.forEach(function(e){g.hasClass(t,e)||g.addClass(t,e)})):t.classList.add(e))},g.removeClass=function(t,e){-1!=e.indexOf(" ")?(classes=e.split(" "),classes.forEach(function(e){g.hasClass(t,e)&&g.removeClass(t,e)})):t.classList.remove(e)},g.attr=function(t,e){return t.getAttribute(e)},g.distance=function(t,e,s,i){var o=t-s,a=e-i;return Math.sqrt(o*o+a*a)},g.formatCommas=function(t){return t=Math.round(t),t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},g.isString=function(t){return"string"==typeof t},g.isObject=function(t){return"object"==typeof t},g.isSet=function(t){return"undefined"!=typeof t},g.isObjEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},g.merge=function(t,e){for(var s in e)t[s]=e[s]},g.audio.add("ui-l",6,[[0,.42,.07,.5,.13,.61,,-.0799,.0032,,.42,.56,.68,.83,.6799,,.1799,.6,.69,.58,,.24,-.0278,.7]]),g.audio.add("ui-m",6,[[0,.42,.07,.5,.13,.84,,.0026,.0032,,.42,.56,.68,.81,.6799,,.1799,.6,.69,.58,,.24,-.0278,.7]]),g.audio.add("ui-h",6,[[0,.42,.07,.5,.13,.9,,,.0032,,.42,.56,.68,.81,.6799,,.1799,.6,.69,.58,,.24,-.0278,.7]]),g.audio.add("ui-open",4,[[2,.0206,.2536,.28,.35,.32,,.02,.06,.54,.7,.9788,,,-1,,-.64,.7,.89,.74,.93,.37,.1102,.35]]),g.audio.add("ui-tap",15,[[2,.16,.0338,,.0273,.94,,1,1,,,-.38,,.0854,,,,,1,,,.1,,.45]]),g.audio.add("fire-e",15,[[0,.0015,.1454,.1299,.35,.17,,2e-4,-.0391,.2938,.2564,.317,,,.6036,.5537,.0251,.8326,.8964,-.9428,.7715,.1282,,.35]]),g.audio.add("fire-w",15,[[2,,.1839,.4625,.2596,.28,.2,.1799,.24,.4829,.8777,-.7658,.0207,.1163,-.162,.285,.1058,-.005,.9952,.027,.0095,,.0344,.3]]),g.audio.add("fire-a",15,[[3,.21,.1784,.3504,.2841,.84,.0057,.52,.56,.0752,.735,.5024,.1312,.452,.5037,.0798,-.1418,-.2362,.4854,-.0141,.3018,.0106,-.0548,.4]]),g.audio.add("fire-f",15,[[3,.13,.21,.15,.32,.1701,.0314,.022,-.0097,,,-.5037,.7324,.0077,-.1999,,.5447,.6625,1,.0991,.1081,.0686,-.078,.3]]),g.audio.add("hit-e",15,[[3,.0032,.7122,.3074,.1242,.4294,,-.7643,.0621,.0073,.9191,.9475,,,-.6928,-.3204,.9318,.5246,.9096,-.8044,.6524,2e-4,.3206,.32]]),g.audio.add("hit-w",15,[[3,.0211,.5274,.0501,.4198,.1625,,.8586,-.0099,,,.7094,,-.6983,.0269,,-4e-4,,.301,-.1429,,.3653,,.35]]),g.audio.add("hit-a",15,[[3,.05,.1,,.1698,.4,,.76,-.62,,,.04,,,-.58,.35,1,.4399,1,-.36,1,,,.35]]),g.audio.add("hit-f",15,[[3,,.26,.26,.32,.31,,-.3399,-.54,,,-.2629,.739,,,,.72,.72,1,-.3399,.73,,,.3]]),g.audio.add("wave",5,[[2,.3605,.3137,.2096,.5834,.5001,,-.4232,,-.0584,-.7583,.3493,.627,-.409,-.5195,.9178,,.5519,.8155,.0368,-.6577,.183,-1e-4,.3]]),g.audio.add("life",5,[[0,.1219,.5797,.5152,.3988,.15,,-.14,-1,.93,.91,-.16,,.03,.62,1,-.0167,-.2123,.9297,-.5433,.1666,,-.0042,.4]]),g.audio.add("gameover",1,[[0,,.9466,.34,.72,.1471,,-.0999,-.5,,,-.7254,,.2,.58,.56,-.0921,-.1867,.9041,-.0156,,,-.006,.3]]),g.audio.add("boss",1,[[3,,.32,.29,.9,.26,,-.7,.6599,,.78,.1667,,,-.0784,.9115,-.12,.6599,.22,.36,.21,,-.3399,.3]]),g.data.map=[[-1,2],[8,2],[8,3],[10,3],[10,2],[12,2],[12,1],[14,1],[14,2],[18,2],[18,5],[14,5],[14,6],[10,6],[10,5],[7,5],[7,8],[11,8],[11,10],[13,10],[13,8],[17,8],[17,10],[19,10],[19,12],[13,12],[13,13],[8,13],[8,10],[5,10],[5,4],[1,4],[1,6],[3,6],[3,8],[0,8],[0,10],[1,10],[1,12],[6,12],[6,14]],g.data.towers={e:{type:"e",counters:"a",title:"Earth",dmg:"Medium",bonus:"+50% vs Air",rng:"Medium",rte:"Medium",stats:[{cst:200,dmg:15,rng:75,rte:30},{cst:250,dmg:21,rng:85,rte:28},{cst:313,dmg:30,rng:95,rte:26}]},w:{type:"w",counters:"f",title:"Water",dmg:"Medium",bonus:"+50% vs Fire",rng:"Low",rte:"High",stats:[{cst:300,dmg:15,rng:65,rte:25},{cst:375,dmg:21,rng:69,rte:22},{cst:469,dmg:30,rng:72,rte:19}]},a:{type:"a",counters:"w",title:"Air",dmg:"Low",bonus:"+50% vs Water",rng:"High",rte:"Medium",stats:[{cst:250,dmg:10,rng:85,rte:30},{cst:313,dmg:12,rng:102,rte:28},{cst:391,dmg:14,rng:121,rte:26}]},f:{type:"f",counters:"e",title:"Fire",dmg:"High",bonus:"+50% vs Earth",rng:"Medium",rte:"Low",stats:[{cst:250,dmg:20,rng:75,rte:35},{cst:313,dmg:33,rng:85,rte:33},{cst:391,dmg:55,rng:95,rte:32}]}},g.data.waves=[["e 11"],["e 9","w 2"],["e 7","w 2","a 2"],["e 5","w 2","a 2","f 2"],["e 1 1","e 3","w 3","a 3","f 3"],["w 13"],["w 11","a 2"],["w 9","a 2","f 2"],["w 7","a 2","f 2","e 2"],["w 1 1","w 5","a 5","f 5","e 5"],["a 15"],["a 13","f 2"],["a 11","f 2","e 2"],["a 9","f 2","e 2","w 2"],["a 1, 1","a 7","f 7","e 7","w 7"],["f 17"],["f 15","e 2"],["f 13","e 2","w 2"],["f 11","e 2","w 2","a 2"],["f 1 1","f 9","e 9","w 9","a 9"]],g.B=function(){this.dom=g.cE(g.qS(".s-play"),"bullet")},g.B.prototype.init=function(t){g.merge(this,t),this.guid=g.guid++,this.size=6,this.radius=this.size/2,this.x-=this.radius,this.y-=this.radius,this.cx=0,this.cy=0,this.rx=0,this.ry=0,this.vx=0,this.vy=0,this.dx=0,this.dy=0,this.dist=0,this.angle=0,this.accel=.1,this.speed=0,this.updateCoords(),g.removeClass(this.dom,"type-e type-w type-a type-f"),g.addClass(this.dom,"type-"+this.type),g.css(this.dom,{width:this.size+"px",height:this.size+"px",transform:"translate3d(-999px, -999px, 0)"})},g.B.prototype.step=function(){if(this.state.isPlaying){var t=this.state.enemies.getByPropVal("guid",this.target);if(t)if(this.dx=t.cx-this.cx,this.dy=t.cy-this.cy,this.dist=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.angle=Math.atan2(this.dy,this.dx),this.vx=Math.cos(this.angle)*this.speed,this.vy=Math.sin(this.angle)*this.speed,this.speed+=this.accel,Math.abs(this.dist)>this.speed)this.x+=this.vx,this.y+=this.vy;else{var e=this.dmg;t.type==this.counters&&(e*=1.5),g.audio.play("hit-"+this.type),t.receiveDamage(e,this.slow),this.destroy()}else this.destroy()}this.updateCoords()},g.B.prototype.draw=function(){g.css(this.dom,"transform","translate3d("+this.rx+"px , "+this.ry+"px, 0) rotate("+(this.angle+Math.PI/4)+"rad)")},g.B.prototype.destroy=function(){g.css(this.dom,"transform","translate3d(-999px , -999px, 0)"),this.state.bullets.release(this)},g.B.prototype.updateCoords=function(){this.cx=this.x+this.size/2,this.cy=this.y+this.size/2,this.rx=this.x,this.ry=this.y},g.E=function(t){g.merge(this,t),this.init()},g.E.prototype.init=function(){this.guid=g.guid++,this.size=14,this.dom={},this.dom.enemy=g.cE(null,"enemy type-"+this.type),this.isBoss&&(g.addClass(this.dom.enemy,"boss"),this.size=20),this.dom.hl=g.cE(this.dom.enemy,"hl"),this.dom.hp=g.cE(this.dom.enemy,"hp"),this.hpTotal=70,this.value=30,this.wp=1,this.angleFlag=1,this.radius=.75*this.size,this.x=g.data.map[0][0]*g.size,this.y=g.data.map[0][1]*g.size,this.cx=0,this.cy=0,this.rx=0,this.ry=0,this.vx=0,this.vy=0,this.dx=0,this.dy=0,this.dist=0,this.angle=0,this.rotation=0,this.speed=1,this.distanceTraveled=0,this.tick=0,this.slowTick=0,this.updateCoords(),g.css(this.dom.enemy,{width:this.size+"px",height:this.size+"px",transform:"translate3d("+this.rx+"px , "+this.ry+"px, 0)"}),this.hpTotal+=25*this.wave,this.speed+=.05*this.wave,this.value+=this.wave,this.isBoss&&(this.hpTotal*=20,this.value*=3,this.speed*=.5),this.hp=this.hpTotal},g.E.prototype.step=function(){if(this.state.isPlaying){var t=this.speed;this.slowTick?(t=.5*t,this.slowTick--,g.addClass(this.dom.enemy,"slow")):g.removeClass(this.dom.enemy,"slow");var e=g.data.map[this.wp];this.dx=e[0]*g.size-this.x,this.dy=e[1]*g.size-this.y,this.dist=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.angleFlag&&(this.angle=Math.atan2(this.dy,this.dx),this.angleFlag=0),this.vx=Math.cos(this.angle)*t,this.vy=Math.sin(this.angle)*t;var s=this.dx,i=this.dy;s/=this.dist?this.dist:1,i/=this.dist?this.dist:1;var o=Math.cos(this.rotation),a=Math.sin(this.rotation);o+=.125*(s-o),a+=.125*(i-a),this.rotation=Math.atan2(a,o),Math.abs(this.dist)>t?(this.x+=this.vx,this.y+=this.vy,this.distanceTraveled+=Math.abs(this.vx)+Math.abs(this.vy)):(this.x=e[0]*g.size,this.y=e[1]*g.size,this.wp+1>=g.data.map.length?(this.destroy(),this.state.removeLife()):(this.wp++,this.angleFlag=1)),this.hitTick>0?this.hitTick--:g.removeClass(this.dom.enemy,"hit"),this.tick++}this.updateCoords()},g.E.prototype.draw=function(){g.css(this.dom.enemy,"transform","translate3d("+this.rx+"px , "+this.ry+"px, 0) rotate("+(this.rotation+Math.PI/4-Math.PI)+"rad)")},g.E.prototype.receiveDamage=function(t,e){e&&(this.slowTick+=e),this.hp-=t,this.hitTick=5,g.addClass(this.dom.enemy,"hit"),g.css(this.dom.hp,{height:this.hp/this.hpTotal*300+"%",width:this.hp/this.hpTotal*300+"%"}),this.hp<=0&&(this.isBoss&&g.audio.play("boss"),this.state.setFragments(this.value),this.destroy())},g.E.prototype.activate=function(){this.state.dom.state.appendChild(this.dom.enemy)},g.E.prototype.destroy=function(){this.state.enemies.remove(this),this.state.dom.state.removeChild(this.dom.enemy)},g.E.prototype.updateCoords=function(){this.cx=this.x+g.size/2,this.cy=this.y+g.size/2,this.rx=this.cx-this.size/2,this.ry=this.cy-this.size/2},g.Ti=function(t){g.merge(this,t),this.init()},g.Ti.prototype.init=function(){this.guid=g.guid++,this.dom=g.cE(this.state.dom.state,this.classes),g.css(this.dom,{transform:"translate("+this.col*g.size+"px , "+this.row*g.size+"px )",width:g.size+"px",height:g.size+"px",zIndex:g.rows-this.row}),g.on(this.dom,"mouseenter",this.onMouseenter,this),g.on(this.dom,"click",this.onClick,this)},g.Ti.prototype.onMouseenter=function(){this.isPath||g.audio.play("ui-tap")},g.Ti.prototype.onClick=function(){this.state.isBuildMenuOpen||this.isPath||(this.state.showBuildMenu(this),this.state.lastClickedTile=this)},g.To=function(t){g.merge(this,t),this.init()},g.To.prototype.init=function(){this.guid=g.guid++,this.data=g.data.towers[this.type],this.lvl=0,this.counters=this.data.counters,this.spent=this.data.stats[0].cst,this.cx=this.col*g.size+g.size/2,this.cy=this.row*g.size+g.size/2,this.turretRotation=0,this.setupDom(),this.setupEvents(),this.setStats()},g.To.prototype.step=function(){var t=this.state.globalTurretRotation;if(this.target){{var e=this.target.cx-this.cx,s=this.target.cy-this.cy;Math.sqrt(e*e+s*s)}t=Math.atan2(s,e)+.75*Math.PI}this.turretRotation=t,this.state.isPlaying&&(this.fire(),this.bulletTick<this.rte&&this.bulletTick++)},g.To.prototype.draw=function(){g.css(this.dom.slab,"transform","rotate("+this.state.globalSlabRotation+"rad)"),g.css(this.dom.turret,"transform","rotate("+this.turretRotation+"rad)"),this.target?(g.addClass(this.dom.wrap,"targeting"),g.css(this.dom.core,"transform","scale("+(.25+.05*Math.sin(.75*this.state.tick))+")")):(g.css(this.dom.core,"transform","scale("+this.state.globalCoreScale+")"),g.removeClass(this.dom.wrap,"targeting"))},g.To.prototype.setStats=function(){var t=this.data.stats[this.lvl];this.dmg=t.dmg,this.rng=t.rng,this.rte=t.rte,this.bulletTick=this.rte,g.css(this.dom.range,{width:2*this.rng+"px",height:2*this.rng+"px"})},g.To.prototype.upgrade=function(){this.lvl++,this.spent+=this.data.stats[this.lvl].cst,this.setStats(),g.removeClass(this.dom.wrap,"t-lvl-0 t-lvl-1 t-lvl-2"),g.addClass(this.dom.wrap,"t-lvl-"+this.lvl)},g.To.prototype.reclaim=function(){this.state.setFragments(Math.ceil(.75*this.spent)),this.state.towers.remove(this),this.state.dom.state.removeChild(this.dom.wrap)},g.To.prototype.getTarget=function(){var t=this.state.enemies,e=[];t.length?(t.each(function(t){var s=g.distance(this.cx,this.cy,t.cx,t.cy);this.rng+t.radius>s&&e.push(t)},1,this),e.length?"w"==this.type?this.target=e[Math.floor(g.rand(0,e.length))]:(e.sort(function(t,e){return t.distanceTraveled-e.distanceTraveled}),this.target=e.pop()):this.target=null):this.target=null},g.To.prototype.fire=function(){if(this.bulletTick>=this.rte&&(this.getTarget(),this.target)){g.audio.play("fire-"+this.type),this.bulletTick=0;var t=0;"w"==this.type&&(t=20+20*this.lvl),this.state.bullets.create({state:this.state,type:this.type,counters:this.counters,dmg:this.dmg,target:this.target.guid,x:this.cx,y:this.cy,slow:t})}},g.To.prototype.setupDom=function(){this.dom={},this.dom.wrap=g.cE(this.state.dom.state,"t-wrap t-lvl-"+this.lvl+" t-type-"+this.type),this.dom.tower=g.cE(this.dom.wrap,"t-tower"),this.dom.slab=g.cE(this.dom.tower,"t-slab"),this.dom.turret=g.cE(this.dom.tower,"t-turret"),this.dom.base=g.cE(this.dom.tower,"t-base"),this.dom.core=g.cE(this.dom.tower,"t-core"),this.dom.range=g.cE(this.dom.tower,"t-range"),g.cE(this.dom.wrap,"t-lvl-bar t-lvl-bar-0"),g.cE(this.dom.wrap,"t-lvl-bar t-lvl-bar-1"),g.cE(this.dom.wrap,"t-lvl-bar t-lvl-bar-2"),g.css(this.dom.wrap,"transform","translate3d("+this.col*g.size+"px , "+this.row*g.size+"px, 0 )")},g.To.prototype.setupEvents=function(){g.on(this.dom.wrap,"click",this.onClick,this)},g.To.prototype.onClick=function(){this.state.isTowerMenuOpen||(this.state.showTowerMenu(this),this.state.lastClickedTowerId=this.guid,this.state.updateTowerMenuAvailability(),g.addClass(this.dom.wrap,"selected"))},g.W=function(t){g.merge(this,t),this.init()},g.W.prototype.init=function(){this.guid=g.guid++,this.tick=0,this.tickMax=50-this.num,this.enemies=new g.Group,this.counts={e:0,w:0,a:0,f:0}},g.W.prototype.step=function(){if(this.state.isPlaying)if(this.tick>=this.tickMax&&this.enemies.length){this.tick=0;var t=this.enemies.shift();t.activate(),this.state.enemies.push(t)}else this.tick++};var StatePlay=function(){};StatePlay.prototype.init=function(){this.isPlaying=0,this.isBuildMenuOpen=0,this.isTowerMenuOpen=0,this.isBuildable=0,this.won=0,this.tick=0,this.hasPlayed=0,this.speed=1,this.wave=0,this.waveNext=this.wave+1,this.wavesTotal=g.data.waves.length,this.livesTotal=13,this.lives=this.livesTotal,this.fragments=500,this.fragmentsDisplay=this.fragments,this.fragmentsDisplayLast=0,this.sendEarlyAmt=0,this.lastClickedTile=null,this.globalSlabRotation=0,this.globalTurretRotation=0,this.globalCoreScale=.1,this.lastClickedTowerId=null,this.towers=new g.Group,this.waves=new g.Group,this.activeWaves=new g.Group,this.enemies=new g.Group,this.bullets=new g.Pool(g.B,20),this.dom={},this.dom.state=g.qS(".s-play"),this.dom.button=g.qS(".b"),this.dom.play=g.qS(".b-play"),this.dom.x1=g.qS(".b-x1"),this.dom.x2=g.qS(".b-x2"),this.dom.x3=g.qS(".b-x3"),this.dom.send=g.qS(".b-send"),this.dom.sendText=g.qS(".send"),this.dom.lives=g.qS(".d-lives"),this.dom.fragments=g.qS(".d-fragments"),this.dom.wave=g.qS(".d-wave"),this.dom.next=g.qS(".d-next"),this.dom.eWave=g.qS(".w-e"),this.dom.wWave=g.qS(".w-w"),this.dom.aWave=g.qS(".w-a"),this.dom.fWave=g.qS(".w-f"),this.dom.buildMenuWrap=g.qS(".build-menu-wrap"),this.dom.buildMenu=g.qS(".build-menu"),this.dom.buildButton=g.qS(".build-button"),this.dom.buildDefault=g.qS(".build-d"),this.dom.buildEarth=g.qS(".build-e"),this.dom.buildWater=g.qS(".build-w"),this.dom.buildAir=g.qS(".build-a"),this.dom.buildFire=g.qS(".build-f"),this.dom.buildCost=g.qS(".build-cost"),this.dom.buildType=g.qS(".build-type"),this.dom.buildDmg=g.qS(".build-dmg"),this.dom.buildRng=g.qS(".build-rng"),this.dom.buildRte=g.qS(".build-rte"),this.dom.towerMenuWrap=g.qS(".tower-menu-wrap"),this.dom.towerMenu=g.qS(".tower-menu"),this.dom.towerButton=g.qS(".tower-button"),this.dom.towerHighlight=g.qS(".tower-button.highlight"),this.dom.towerUpgrade=g.qS(".tower-button.upgrade"),this.dom.towerReclaim=g.qS(".tower-button.reclaim"),this.dom.towerCost=g.qS(".tower-cost"),this.dom.towerLabel=g.qS(".tower-label"),this.dom.towerDmg=g.qS(".tower-dmg"),this.dom.towerRng=g.qS(".tower-rng"),this.dom.towerRte=g.qS(".tower-rte"),this.dom.towerDmgNext=g.qS(".tower-dmg-next"),this.dom.towerRngNext=g.qS(".tower-rng-next"),this.dom.towerRteNext=g.qS(".tower-rte-next"),document.onselectstart=function(){return!1},g.on(window,"click",this.onWinClick,this),g.on(this.dom.play,"click",this.onPlayClick,this),g.on(this.dom.x1,"click",this.onX1Click,this),g.on(this.dom.x2,"click",this.onX2Click,this),g.on(this.dom.x3,"click",this.onX3Click,this),g.on(this.dom.send,"click",this.onSendClick,this);for(var t=0,e=this.dom.button.length;e>t;t++){var s=this.dom.button[t];g.on(s,"mouseenter",this.onButtonMouseenter,this),g.on(s,"click",this.onButtonClick,this)}g.on(this.dom.buildMenuWrap,"click",this.onBuildMenuWrapClick,this),g.on(this.dom.buildMenu,"click",this.onBuildMenuClick,this);for(var i=0,o=this.dom.buildButton.length;o>i;i++){var a=this.dom.buildButton[i];g.on(a,"mouseenter",this.onBuildButtonMouseenter,this),g.on(a,"mouseleave",this.onBuildButtonMouseleave,this),g.on(a,"click",this.onBuildButtonClick,this)}g.on(this.dom.towerMenuWrap,"click",this.onTowerMenuWrapClick,this),g.on(this.dom.towerMenu,"click",this.onTowerMenuClick,this);for(var h=0,n=this.dom.towerButton.length;n>h;h++){var r=this.dom.towerButton[h];g.on(r,"mouseenter",this.onTowerButtonMouseenter,this),g.on(r,"mouseleave",this.onTowerButtonMouseleave,this),g.on(r,"click",this.onTowerButtonClick,this)}this.updateLife(),this.setupTiles(),this.setupWaves(),this.isPlaying=1,this.step(),this.isPlaying=0},StatePlay.prototype.step=function(){this.updateFragments();for(var t=0;t<this.speed;t++)this.updateGlobals(),this.towers.each("step"),this.enemies.each("step"),this.bullets.each("step"),this.updateWaves();this.tick++},StatePlay.prototype.draw=function(){this.towers.each("draw"),this.enemies.each("draw"),this.bullets.each("draw")},StatePlay.prototype.onWinClick=function(){this.isBuildMenuOpen&&(g.audio.play("ui-l"),this.hideBuildMenu()),this.isTowerMenuOpen&&(g.audio.play("ui-l"),this.hideTowerMenu())},StatePlay.prototype.onButtonMouseenter=function(){g.audio.play("ui-m")},StatePlay.prototype.onButtonClick=function(){g.audio.play("ui-h")},StatePlay.prototype.onPlayClick=function(){this.hasPlayed||(this.advanceWave(),this.hasPlayed=1),this.isPlaying=!this.isPlaying,this.isPlaying?g.addClass(g.dom,"playing"):g.removeClass(g.dom,"playing")},StatePlay.prototype.onX1Click=function(){this.speed=1,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x1")},StatePlay.prototype.onX2Click=function(){this.speed=2,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x2")},StatePlay.prototype.onX3Click=function(){this.speed=3,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x3")},StatePlay.prototype.onSendClick=function(){this.isPlaying&&(this.setFragments(this.sendEarlyAmt),this.advanceWave())},StatePlay.prototype.setupTiles=function(){this.baseTiles=new g.Group,this.pathTiles=new g.Group;for(var t=0;t<g.cols;t++)for(var e=0;e<g.rows;e++){var s=this.isPath(t,e),i=["tile"];s&&(i+=" path");var o=new g.Ti({state:this,col:t,row:e,isPath:s||0,classes:i,horizontal:t>g.cols/2?"e":"w",vertical:e>g.rows/2?"s":"n"});s?this.pathTiles.push(o):this.baseTiles.push(o)}},StatePlay.prototype.isPath=function(t,e){for(var s=g.data.map.length,i=0;s-1>i;i++){var o=g.data.map[i],a=g.data.map[i+1],h=Math.min(o[0],a[0]),n=Math.min(o[1],a[1]),r=Math.max(o[0],a[0]),d=Math.max(o[1],a[1]);if(t>=h&&r>=t&&e>=n&&d>=e)return 1}},StatePlay.prototype.updateGlobals=function(){this.globalSlabRotation-=.025,this.globalTurretRotation+=.025,this.globalCoreScale=.3+.15*Math.sin(this.tick/30)},StatePlay.prototype.removeLife=function(){g.audio.play("life"),this.lives--,this.updateLife(),this.lives||(g.audio.play("gameover"),setTimeout(function(){alert("You lost."),location.reload()},1e3))},StatePlay.prototype.updateLife=function(){g.text(this.dom.lives,Math.max(0,this.lives)+" / "+this.livesTotal)},StatePlay.prototype.setFragments=function(t){this.fragments+=t,this.updateBuildMenuAvailability(),this.updateTowerMenuAvailability(),this.updateTowerUpgradeAvailability()},StatePlay.prototype.updateFragments=function(){this.fragmentsDisplay+=.2*(this.fragments-this.fragmentsDisplay),Math.round(this.fragmentsDisplay)!=Math.round(this.fragmentsDisplayLast)&&g.text(this.dom.fragments,g.formatCommas(this.fragmentsDisplay)),this.fragmentsDisplayLast=this.fragmentsDisplay},StatePlay.prototype.setupWaves=function(){for(var t=0,e=g.data.waves.length;e>t;t++){for(var s=g.data.waves[t],i=new g.W({state:this,num:t}),o=0,a=s.length;a>o;o++)for(var h=s[o].split(" "),n=h[0],r=h[1],d=h.length>=3?1:0,l=0,u=r;u>l;l++){var p=new g.E({state:this,type:n,isBoss:d,wave:t});i.enemies.push(p),i.counts[n]++}this.waves.push(i)}},StatePlay.prototype.updateWaves=function(){if(this.isPlaying&&(this.waves.length?(this.sendEarlyAmt-=3e-4*(50+10*this.wave),this.sendEarlyAmt=Math.max(0,this.sendEarlyAmt)):this.sendEarlyAmt=0,g.text(this.dom.sendText,Math.ceil(this.sendEarlyAmt))),this.activeWaves.each("step"),this.activeWaves.length||!this.waves.length||this.enemies.length||this.advanceWave(),this.activeWaves.each(function(t,e){t.enemies.length||this.activeWaves.removeAt(e)},0,this),!(this.activeWaves.length||this.waves.length||this.enemies.length||this.won)){this.won=1;var t=100*this.lives+this.fragments;setTimeout(function(){alert("You won! Based on lives and elemental fragments left, your score is: "+g.formatCommas(t)),location.reload()},1e3)}},StatePlay.prototype.advanceWave=function(){if(this.hasPlayed){if(this.waves.length)if(this.activeWaves.push(this.waves.shift()),g.text(this.dom.wave,this.wave+1+" / "+this.wavesTotal),this.wave++,g.audio.play("wave"),this.wave<this.wavesTotal){this.waveNext++;var t=this.waves.getAt(0);this.sendEarlyAmt=50+10*this.wave,g.text(this.dom.eWave,t.counts.e),g.text(this.dom.wWave,t.counts.w),g.text(this.dom.aWave,t.counts.a),g.text(this.dom.fWave,t.counts.f)}else this.waveNext=null,g.text(this.dom.eWave,"--"),g.text(this.dom.wWave,"--"),g.text(this.dom.aWave,"--"),g.text(this.dom.fWave,"--"),g.addClass(g.dom,"no-more-waves")}else{var e=this.waves.getAt(0);g.text(this.dom.eWave,e.counts.e),g.text(this.dom.wWave,e.counts.w),g.text(this.dom.aWave,e.counts.a),g.text(this.dom.fWave,e.counts.f),g.text(this.dom.wave,this.wave+" / "+this.wavesTotal)}},StatePlay.prototype.showBuildMenu=function(t){g.audio.play("ui-open"),this.isBuildMenuOpen=1,this.isBuildable=1,g.addClass(g.dom,"build-menu-open"),g.removeClass(g.dom,"pos-n pos-e pos-s pos-w"),g.addClass(g.dom,"pos-"+t.horizontal+" pos-"+t.vertical);var e=t.col*g.size-20,s=t.row*g.size-20;"e"==t.horizontal&&(e-=200),g.css(this.dom.buildMenu,"transform","translateX("+e+"px) translateY("+s+"px)"),g.resetAnim(this.dom.buildDefault)},StatePlay.prototype.hideBuildMenu=function(){this.isBuildMenuOpen=0,g.removeClass(g.dom,"build-menu-open")},StatePlay.prototype.updateBuildMenuText=function(t){var e=g.data.towers[t];g.text(this.dom.buildCost,e.stats[0].cst),g.text(this.dom.buildType,e.title),g.text(this.dom.buildDmg,e.dmg+" "+e.bonus),g.text(this.dom.buildRng,e.rng),g.text(this.dom.buildRte,e.rte),g.removeClass(g.dom,"hover-e hover-w hover-a hover-f"),g.addClass(g.dom,"hover-build-button hover-"+t),g.removeClass(g.dom,"dmg1 dmg2 dmg3 rng1 rng2 rng3 rte1 rte2 rte3");var s=1,i=1,o=1;"Medium"==e.dmg?s=2:"High"==e.dmg&&(s=3),"Medium"==e.rng?i=2:"High"==e.rng&&(i=3),"Medium"==e.rte?o=2:"High"==e.rte&&(o=3),g.addClass(g.dom,"dmg"+s),g.addClass(g.dom,"rng"+i),g.addClass(g.dom,"rte"+o)},StatePlay.prototype.updateBuildMenuAvailability=function(){g.removeClass(g.dom,"no-b-e no-b-w no-b-a no-b-f");var t="";this.fragments<g.data.towers.e.stats[0].cst&&(t+="no-b-e "),this.fragments<g.data.towers.w.stats[0].cst&&(t+="no-b-w "),this.fragments<g.data.towers.a.stats[0].cst&&(t+="no-b-a "),this.fragments<g.data.towers.f.stats[0].cst&&(t+="no-b-f "),g.addClass(g.dom,t)},StatePlay.prototype.onBuildMenuWrapClick=function(){g.audio.play("ui-l"),this.hideBuildMenu()},StatePlay.prototype.onBuildMenuClick=function(t){t.stopPropagation()},StatePlay.prototype.onBuildButtonMouseenter=function(t){var e=g.attr(t.target,"data-type");e&&(g.audio.play("ui-m"),this.updateBuildMenuText(e))},StatePlay.prototype.onBuildButtonMouseleave=function(){g.removeClass(g.dom,"hover-build-button")},StatePlay.prototype.onBuildButtonClick=function(t){var e=g.attr(t.target,"data-type");if(e){var s=g.data.towers[e].stats[0].cst;if(s<=this.fragments&&this.isBuildable){g.audio.play("ui-h"),this.setFragments(-s);var i=this.lastClickedTile,o=new g.To({state:this,col:i.col,row:i.row,horizontal:i.horizontal,vertical:i.vertical,type:e});this.towers.push(o),this.isBuildable=0,this.hideBuildMenu(),this.updateTowerUpgradeAvailability()}}},StatePlay.prototype.showTowerMenu=function(t){g.audio.play("ui-open"),this.isTowerMenuOpen=1,g.addClass(g.dom,"tower-menu-open"),g.removeClass(g.dom,"t-menu-e t-menu-w t-menu-a t-menu-f"),g.addClass(g.dom,"t-menu-"+t.type),g.removeClass(g.dom,"pos-n pos-e pos-s pos-w"),g.addClass(g.dom,"pos-"+t.horizontal+" pos-"+t.vertical);var e=t.col*g.size-20,s=t.row*g.size-20;"e"==t.horizontal&&(e-=200),g.css(this.dom.towerMenu,"transform","translateX("+e+"px) translateY("+s+"px)"),g.resetAnim(this.dom.towerHighlight)},StatePlay.prototype.hideTowerMenu=function(){this.isTowerMenuOpen=0,g.removeClass(g.dom,"tower-menu-open"),this.towers.each(function(t){g.removeClass(t.dom.wrap,"selected")},1,this)},StatePlay.prototype.updateTowerMenuText=function(t){var e=this.getLastClickedTower();if(e){var s=g.data.towers[e.type];"upgrade"==t?(g.addClass(g.dom,"hover-tower-button hover-tower-upgrade"),e.lvl<2?(g.text(this.dom.towerCost,s.stats[e.lvl+1].cst),g.text(this.dom.towerLabel,"Upgrade to Level "+(e.lvl+2)),g.text(this.dom.towerDmg,s.stats[e.lvl].dmg),g.text(this.dom.towerRng,s.stats[e.lvl].rng),g.text(this.dom.towerRte,60-s.stats[e.lvl].rte),g.text(this.dom.towerDmgNext,s.stats[e.lvl+1].dmg),g.text(this.dom.towerRngNext,s.stats[e.lvl+1].rng),g.text(this.dom.towerRteNext,60-s.stats[e.lvl+1].rte)):(g.text(this.dom.towerCost,"Maxed"),g.text(this.dom.towerLabel,s.title+" Level "+(e.lvl+1)),g.text(this.dom.towerDmg,s.stats[e.lvl].dmg),g.text(this.dom.towerRng,s.stats[e.lvl].rng),g.text(this.dom.towerRte,60-s.stats[e.lvl].rte),g.text(this.dom.towerDmgNext,"Maxed"),g.text(this.dom.towerRngNext,"Maxed"),g.text(this.dom.towerRteNext,"Maxed"))):"reclaim"==t&&(g.addClass(g.dom,"hover-tower-button hover-tower-reclaim"),g.text(this.dom.towerCost,"+"+Math.ceil(.75*e.spent)),g.text(this.dom.towerLabel,"Reclaim 75%"),g.text(this.dom.towerDmg,s.stats[e.lvl].dmg),g.text(this.dom.towerRng,s.stats[e.lvl].rng),g.text(this.dom.towerRte,60-s.stats[e.lvl].rte))}},StatePlay.prototype.updateTowerMenuAvailability=function(){var t=this.getLastClickedTower();if(t){g.removeClass(g.dom,"no-upgrade maxed-upgrade");
var e=t.lvl;2==e?g.addClass(g.dom,"no-upgrade maxed-upgrade"):this.fragments<g.data.towers[t.type].stats[e+1].cst&&g.addClass(g.dom,"no-upgrade")}},StatePlay.prototype.updateTowerUpgradeAvailability=function(){this.towers.each(function(t){t.lvl<2?this.fragments>=g.data.towers[t.type].stats[t.lvl+1].cst?(t.upgradable=1,g.addClass(t.dom.wrap,"upgradable")):(t.upgradable=0,g.removeClass(t.dom.wrap,"upgradable")):(t.upgradable=0,g.removeClass(t.dom.wrap,"upgradable"))},0,this)},StatePlay.prototype.onTowerMenuWrapClick=function(){g.audio.play("ui-l"),this.hideTowerMenu()},StatePlay.prototype.onTowerMenuClick=function(t){t.stopPropagation()},StatePlay.prototype.onTowerButtonMouseenter=function(t){g.audio.play("ui-m"),this.updateTowerMenuText(g.attr(t.target,"data-action"))},StatePlay.prototype.onTowerButtonMouseleave=function(){g.removeClass(g.dom,"hover-tower-button hover-tower-upgrade hover-tower-reclaim")},StatePlay.prototype.onTowerButtonClick=function(t){g.audio.play("ui-h");var e=g.attr(t.target,"data-action"),s=this.getLastClickedTower();"upgrade"==e?s.upgradable&&(s.upgrade(),this.setFragments(-g.data.towers[s.type].stats[s.lvl].cst),this.updateTowerMenuText("upgrade")):"reclaim"==e&&(s.reclaim(),this.hideTowerMenu())},StatePlay.prototype.getLastClickedTower=function(){return this.lastClickedTowerId?this.towers.getByPropVal("guid",this.lastClickedTowerId):void 0},g.init=function(){g.guid=0,g.size=40,g.width=800,g.height=600,g.cols=g.width/g.size,g.rows=g.height/g.size,g.dom=g.qS(".g"),g.css(g.dom,{width:g.width+"px",height:g.height+"px"}),g.on(window,"load",g.onLoad),g.on(g.dom,"click",g.onClick),g.play=new StatePlay,g.play.init(),g.step()},g.step=function(){requestAnimationFrame(g.step),g.play.step(),g.play.draw()},g.onLoad=function(){g.addClass(g.dom,"loaded")},g.onClick=function(t){t.stopPropagation()},g.init();</script>